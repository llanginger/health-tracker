"use strict";var app=app||{},trackSuggest=-1,keys={ESC:27,TAB:9,ENTER:13,LEFT:37,UP:38,RIGHT:39,DOWN:40},nSets={searchUrl:"https://api.nutritionix.com/v1_1/search/",autoUrl:"https://api.nutritionix.com/v2/autocomplete?",appId:"appId=02cd80d0",appKey:"appKey=421b1fb27190316a6585e273b648dd6f",fields:"fields=*"};app.AppView=Backbone.View.extend({el:"#app",events:{"click    #leo-auto-bar":"edit","click    .food-option":"printOption","keyup    #leo-auto-bar":"onKeypress","keydown  #leo-auto-bar":"upDownEtc",click:"hideOptions","click    .main-ate-that":"addFoodToLog","click    #clear-log":"clearFoodLog","click    .select-food-option":"thisCalories","click    .leo-auto-suggest":"onEnter","click    #close-tutorial":"closeTutorial","click    #show-tutorial":"showTutorial"},initialize:function(){this.$overlay=$("#overlay"),this.$leoInput=$("#leo-auto-bar"),this.$autoSuggestions=$(".leo-auto-suggestions"),this.$overlayInfo=$("#overlay-info"),this.$overlayGroup=$("#overlay-group"),this.listenTo(this.model,"change",this.render),this.listenTo(app.FoodItems,"add",this.createList),this.listenTo(app.FoodLog,"add",this.renderLog),this.render()},render:function(){return this.$input=this.$(".edit"),this},thisCalories:function(){var e=app.FoodItems.where({selected:!0})[0].get("calories");$("#item-cals").html("That has: <span class='accent-color'>"+Math.round(e)+"</span> calories!")},addFoodToLog:function(){var e=app.FoodItems.where({selected:!0});app.FoodLog.create({title:e[0].get("title"),calories:e[0].get("calories"),date:e[0].get("date"),brand:e[0].get("brand")})},closeTutorial:function(){this.$overlay.fadeOut("fast"),this.$overlayInfo.fadeOut("fast")},showTutorial:function(){this.$overlay.fadeIn("fast").removeClass("hidden"),this.$overlayInfo.fadeIn("fast").removeClass("hidden")},edit:function(){"What did you just eat?"===this.$input.val()&&this.$input.val(""),this.$el.addClass("editing")},hideOptions:function(e){(e.target!=$(".leo-auto-suggest")||e.target!=this.$input)&&this.$autoSuggestions.html("")},resetFoodItems:function(){app.FoodItems.reset()},clearFoodLog:function(){app.FoodLog.reset(),$("#food-log").html(""),$("#total-cals").html("").text("Total calories tracked: 0")},newDate:function(){var e=new Date,t={currDate:e.getDate(),currDay:e.getDay(),currMonth:e.getMonth(),currYear:e.getFullYear(),currHour:e.getHours()},o=function(){return t.currHour>12?t.currHour-12+" pm":t.currHour+" am"},a=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],s=o()+", "+a[t.currDay]+" "+t.currMonth+" "+t.currYear;return s},newModel:function(e,t,o){var a=function(e){return"Nutritionix"!=e&&"USDA"!=e?e:"Generic"};app.FoodItems.create({title:e,calories:t,brand:a(o),date:this.newDate()})},createList:function(e){var t=new app.FoodItemView({model:e});$("#select-food-item").append(t.render().el)},renderLog:function(e){var t=new app.LogView({model:e});$("#food-log").prepend(t.render().el)},onEnter:function(){this.$autoSuggestions.html("");var e=this,t=this.$input.val().trim();t&&$.ajax(nSets.searchUrl+t+"?"+nSets.fields+"&"+nSets.appId+"&"+nSets.appKey).fail(function(){alert("Oops, we couldn't find anything like that!")}).done(function(t){$("#select-food-item").html(""),e.resetFoodItems();for(var o in t.hits){var a=t.hits[o].fields;e.newModel(a.item_name,a.nf_calories,a.brand_name)}})},onKeypress:function(e){var t=this;if(""===this.$leoInput.val().trim()?this.$autoSuggestions.html("").addClass("hidden"):this.$autoSuggestions.removeClass("hidden"),e.which!=keys.DOWN&&e.which!=keys.UP&&e.which!=keys.ENTER&&e.which!=keys.TAB&&e.which!=keys.LEFT&&e.which!=keys.RIGHT&&e.which!=keys.ESC){var o=nSets.autoUrl+"&"+nSets.appId+"&"+nSets.appKey,a=t.$leoInput.val().trim();""!=a&&$.ajax(o+"&q="+a).fail(function(e){alert("Nutri api call failed")}).done(function(e){t.$autoSuggestions.html("");for(var o in e)if(e.hasOwnProperty(o)){var a=e[o].text;t.$autoSuggestions.append("<div class='leo-auto-suggest' data-index='"+o+"'>"+a+"</div>")}$(".leo-auto-suggest").click(function(){$("#leo-auto-bar").val($(this).text()),t.$autoSuggestions.addClass("hidden")}),$(".leo-auto-suggest").mouseenter(function(){$(".leo-auto-suggest").removeClass("leo-selected"),$(this).addClass("leo-selected"),trackSuggest=-1}),$(".leo-auto-suggest").mouseleave(function(){$(this).removeClass("leo-selected")})})}},upDownEtc:function(e){var t=this;e.which===keys.DOWN?(e.preventDefault(),trackSuggest<=$(".leo-auto-suggest").length-2&&(trackSuggest++,$(".leo-auto-suggest").removeClass("leo-selected"),$("[data-index*='"+trackSuggest+"']").addClass("leo-selected"))):e.which===keys.UP&&trackSuggest>0?(e.preventDefault(),trackSuggest--,$(".leo-auto-suggest").removeClass("leo-selected"),$("[data-index*='"+trackSuggest+"']").addClass("leo-selected")):e.which===keys.ENTER?($("#leo-auto-bar").val($(".leo-selected").text()),t.onEnter(),trackSuggest=-1):e.which===keys.ESC&&(this.$autoSuggestions.html(""),trackSuggest=-1)}});