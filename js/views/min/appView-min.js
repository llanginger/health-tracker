var app=app||{},keys={ESC:27,TAB:9,ENTER:13,LEFT:37,UP:38,RIGHT:39,DOWN:40},nSets={searchUrl:"https://api.nutritionix.com/v1_1/search/",autoUrl:"https://api.nutritionix.com/v2/autocomplete?",appId:"appId=02cd80d0",appKey:"appKey=421b1fb27190316a6585e273b648dd6f",fields:"fields=*"};$(function(){$("body").click(function(e){console.log(e.target)})}),app.AppView=Backbone.View.extend({el:"#app",events:{"click #leo-auto-bar":"edit","click .food-option":"printOption","keypress #leo-auto-bar":"onKeypress","focus #leo-auto-bar":"showOptions",click:"hideOptions","click .main-ate-that":"addFoodToLog","click #clear-log":"clearFoodLog","click .select-food-option":"thisCalories","click .leo-auto-suggest":"onEnter","click #close-tutorial":"closeTutorial","click #show-tutorial":"showTutorial"},initialize:function(){this.$overlay=$("#overlay"),this.$overlayInfo=$("#overlay-info"),this.$overlayGroup=$("#overlay-group"),this.listenTo(this.model,"change",this.render),this.listenTo(app.FoodItems,"add",this.createList),this.listenTo(app.FoodLog,"add",this.renderLog),this.render(),_.bindAll(this,"onEnter"),console.log("Init fired")},thisCalories:function(){var e=app.FoodItems.where({selected:!0})[0].get("calories");console.log(e),$("#item-cals").html("That has: <span class='accent-color'>"+Math.round(e)+"</span> calories!")},addFoodToLog:function(){var e=app.FoodItems.where({selected:!0});app.FoodLog.create({title:e[0].get("title"),calories:e[0].get("calories"),date:e[0].get("date"),brand:e[0].get("brand")}),console.log()},render:function(){return this.$input=this.$(".edit"),console.log(JSON.stringify(this.model)),this},closeTutorial:function(){this.$overlay.fadeOut("fast"),this.$overlayInfo.fadeOut("fast")},showTutorial:function(){console.log("show tut"),this.$overlay.fadeIn("fast").removeClass("hidden"),this.$overlayInfo.fadeIn("fast").removeClass("hidden")},edit:function(){"What did you just eat?"===this.$input.val()&&this.$input.val(""),this.$el.addClass("editing"),console.log(this.$input.val()),console.log("Edit fired")},showOptions:function(){$(".leo-auto-suggestions").children().length>0&&$(".leo-auto-suggestions").removeClass("hidden")},hideOptions:function(e){(e.target!=$(".leo-auto-suggest")||e.target!=$("#leo-auto-bar"))&&$(".leo-auto-suggestions").addClass("hidden")},resetFoodItems:function(){app.FoodItems.reset()},clearFoodLog:function(){console.log("food Log Cleared"),app.FoodLog.reset(),$("#food-log").html(""),$("#total-cals").html("").text("Total calories tracked: 0")},newModel:function(e,o,t){var s=new Date,a={currDate:s.getDate(),currDay:s.getDay(),currMonth:s.getMonth(),currYear:s.getFullYear(),currHour:s.getHours()},l=function(){return a.currHour>12?a.currHour-12+" pm":a.currHour+" am"},i=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],n=l()+", "+i[a.currDay]+" "+a.currMonth+" "+a.currYear;app.FoodItems.create({title:e,calories:o,brand:t,date:n})},createList:function(e){var o=new app.FoodItemView({model:e});$("#select-food-item").append(o.render().el)},renderLog:function(e){console.log("log render fired");var o=new app.LogView({model:e});$("#food-log").append(o.render().el)},onEnter:function(){$(".leo-auto-suggestions").html("");var e=this;console.log("onEnter triggered");var o=this.$input.val().trim();o&&(console.log(o),$.ajax(nSets.searchUrl+o+"?"+nSets.fields+"&"+nSets.appId+"&"+nSets.appKey).fail(function(e){console.log("Nutri api call failed")}).done(function(o){$("#select-food-item").html(""),e.resetFoodItems(),console.log(o);for(var t in o.hits){var s=o.hits[t].fields;e.newModel(s.item_name,s.nf_calories,s.brand_name)}}))},onKeypress:function(){var e=this,o=-1;$(".leo-auto-suggestions").children().length>0&&$(".leo-auto-suggestions").removeClass("hidden"),$("#leo-auto-bar").off().keydown(function(t){if($("input").bind("keydown",function(e){("38"==e.which||"40"==e.which||"13"==e.which)&&e.preventDefault()}),console.log(t.which),t.which!=keys.DOWN&&t.which!=keys.UP&&t.which!=keys.ENTER&&t.which!=keys.TAB&&t.which!=keys.LEFT&&t.which!=keys.RIGHT&&t.which!=keys.ESC){var s=nSets.autoUrl+"&"+nSets.appId+"&"+nSets.appKey,a=$(this).val().trim();""!=a&&$.ajax(s+"&q="+a).fail(function(e){alert("Nutri api call failed")}).done(function(e){$(".leo-auto-suggestions").html("");for(var t in e)if(e.hasOwnProperty(t)){var s=e[t].text;$(".leo-auto-suggestions").append("<div class='leo-auto-suggest' data-index='"+t+"'>"+s+"</div>")}$(".leo-auto-suggestions").removeClass("hidden"),$(".leo-auto-suggest").click(function(){$("#leo-auto-bar").val($(this).text()),$(".leo-auto-suggestions").addClass("hidden")}),$(".leo-auto-suggest").mouseenter(function(){$(".leo-auto-suggest").removeClass("leo-selected"),$(this).addClass("leo-selected"),o=-1}),$(".leo-auto-suggest").mouseleave(function(){$(this).removeClass("leo-selected")})})}t.which===keys.DOWN?o<=$(".leo-auto-suggest").length-2&&(o++,$(".leo-auto-suggest").removeClass("leo-selected"),$("[data-index*='"+o+"']").addClass("leo-selected")):t.which===keys.UP&&o>0?(o--,$(".leo-auto-suggest").removeClass("leo-selected"),$("[data-index*='"+o+"']").addClass("leo-selected")):t.which===keys.ENTER?(console.log($(".leo-selected").text()),$("#leo-auto-bar").val($(".leo-selected").text()),e.onEnter()):t.which===keys.ESC&&$(".leo-auto-suggestions").html("")})}});