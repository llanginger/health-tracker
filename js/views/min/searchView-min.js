var app=app||{},keys={ESC:27,TAB:9,ENTER:13,LEFT:37,UP:38,RIGHT:39,DOWN:40},nSets={searchUrl:"https://api.nutritionix.com/v1_1/search/",autoUrl:"https://api.nutritionix.com/v2/autocomplete?",appId:"appId=02cd80d0",appKey:"appKey=421b1fb27190316a6585e273b648dd6f",fields:"fields=*"};$(function(){$("body").click(function(e){console.log(e.target)})}),app.SearchView=Backbone.View.extend({el:"#search-div",events:{"click #leo-auto-bar":"edit","click .food-option":"printOption","keypress #leo-auto-bar":"onKeypress","focus #leo-auto-bar":"showOptions",click:"hideOptions"},initialize:function(){this.listenTo(this.model,"change",this.render),this.listenTo(app.FoodItems,"add",this.addOne),this.render(),_.bindAll(this,"onEnter"),console.log("Init fired")},render:function(){return this.$input=this.$(".edit"),console.log(JSON.stringify(this.model)),this},edit:function(){"What did you just eat?"===this.$input.val()&&this.$input.val(""),this.$el.addClass("editing"),console.log(this.$input.val()),console.log("Edit fired")},showOptions:function(){$(".leo-auto-suggestions").children().length>0&&$(".leo-auto-suggestions").removeClass("hidden")},hideOptions:function(e){(e.target!=$(".leo-auto-suggest")||e.target!=$("#leo-auto-bar"))&&$(".leo-auto-suggestions").addClass("hidden")},newAttributes:function(e,t,o){return{title:this.title,id:app.FoodItems.nextId(),calories:this.calories,brand:this.brand}},resetFoodItems:function(){app.FoodItems.reset()},newModel:function(e,t,o){var s=new Date,i={currDate:s.getDate(),currDay:s.getDay(),currMonth:s.getMonth(),currYear:s.getFullYear(),currHour:s.getHours()},n=function(){return i.currHour>12?i.currHour-12+" pm":i.currHour+" am"},a=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],l=n()+", "+a[i.currDay]+" "+i.currMonth+" "+i.currYear;app.FoodItems.create({title:e,calories:t,brand:o,date:l})},addOne:function(e){var t=new app.FoodItemView({model:e});$("#item-view").append(t.render().el)},onEnter:function(){var e=this;console.log("onEnter triggered");var t=this.$input.val().trim();t&&(console.log(t),$.ajax(nSets.searchUrl+t+"?"+nSets.fields+"&"+nSets.appId+"&"+nSets.appKey).fail(function(e){console.log("Nutri api call failed")}).done(function(t){$("#select-food-item").html(""),e.resetFoodItems(),console.log(t);for(var o in t.hits){var s=t.hits[o].fields;e.newModel(s.item_name,s.nf_calories,s.brand_name)}}))},onKeypress:function(){var e=this,t=-1;$(".leo-auto-suggestions").children().length>0&&$(".leo-auto-suggestions").removeClass("hidden"),$("#leo-auto-bar").off().keydown(function(o){if($("input").bind("keydown",function(e){("38"==e.which||"40"==e.which||"13"==e.which)&&e.preventDefault()}),console.log(o.which),o.which!=keys.DOWN&&o.which!=keys.UP&&o.which!=keys.ENTER&&o.which!=keys.TAB&&o.which!=keys.LEFT&&o.which!=keys.RIGHT&&o.which!=keys.ESC){var s=nSets.autoUrl+"&"+nSets.appId+"&"+nSets.appKey,i=$(this).val().trim();""!=i&&$.ajax(s+"&q="+i).fail(function(e){alert("Nutri api call failed")}).done(function(e){$(".leo-auto-suggestions").html("");for(var o in e)if(e.hasOwnProperty(o)){var s=e[o].text;$(".leo-auto-suggestions").append("<div class='leo-auto-suggest' data-index='"+o+"'>"+s+"</div>")}$(".leo-auto-suggestions").removeClass("hidden"),$(".leo-auto-suggest").click(function(){$("#leo-auto-bar").val($(this).text()),$(".leo-auto-suggestions").addClass("hidden")}),$(".leo-auto-suggest").mouseenter(function(){$(".leo-auto-suggest").removeClass("leo-selected"),$(this).addClass("leo-selected"),t=-1}),$(".leo-auto-suggest").mouseleave(function(){$(this).removeClass("leo-selected")})})}o.which===keys.DOWN?(t++,$(".leo-auto-suggest").removeClass("leo-selected"),$("[data-index*='"+t+"']").addClass("leo-selected")):o.which===keys.UP&&t>0?(t--,$(".leo-auto-suggest").removeClass("leo-selected"),$("[data-index*='"+t+"']").addClass("leo-selected")):o.which===keys.ENTER?(console.log($(".leo-selected").text()),$("#leo-auto-bar").val($(".leo-selected").text()),e.onEnter()):o.which===keys.ESC&&$(".leo-auto-suggestions").html("")})}});