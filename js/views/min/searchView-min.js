var app=app||{},keys={ESC:27,TAB:9,ENTER:13,LEFT:37,UP:38,RIGHT:39,DOWN:40},nSets={searchUrl:"https://api.nutritionix.com/v1_1/search/",autoUrl:"https://api.nutritionix.com/v2/autocomplete?",appId:"appId=02cd80d0",appKey:"appKey=421b1fb27190316a6585e273b648dd6f",fields:"fields=item_name%2Citem_id%2Cbrand_name%2Cnf_calories%2Cnf_total_fat"};$(function(){$("body").click(function(e){console.log(e.target)})}),app.SearchView=Backbone.View.extend({el:"#search-div",events:{"click #leo-auto-bar":"edit","click .food-option":"printOption","keypress #leo-auto-bar":"onKeypress","focus #leo-auto-bar":"showOptions",click:"hideOptions"},initialize:function(){this.listenTo(this.model,"change",this.render),this.render(),console.log("Something happened")},render:function(){return this.$input=this.$(".edit"),console.log(JSON.stringify(this.model)),this},edit:function(){"What did you just eat?"===this.$input.val()&&this.$input.val(""),this.$el.addClass("editing"),console.log(this.$input.val()),console.log("Edit fired")},showOptions:function(){$(".leo-auto-suggestions").children().length>0&&$(".leo-auto-suggestions").removeClass("hidden")},hideOptions:function(e){(e.target!=$(".leo-auto-suggest")||e.target!=$("#leo-auto-bar"))&&$(".leo-auto-suggestions").addClass("hidden")},close:function(){},onEnter:function(){console.log("onEnter triggered");var e=this.$input.val().trim();e&&(console.log(e),$.ajax(nSets.searchUrl+e+"?"+nSets.fields+"&"+nSets.appId+"&"+nSets.appKey).fail(function(e){console.log("Nutri api call failed")}).done(function(o){console.log(nSets.searchUrl+e+"?"+nSets.fields+"&"+nSets.appId+"&"+nSets.appKey),$("#food-items").html("").append("<div id='food-list'></div>"),console.log(o);for(var t in o.hits){var s=o.hits[t].fields;console.log(s.item_name),$("#food-list").append("<div class='food-item'><ul><li>"+s.item_name+"</li> <li>"+s.brand_name+"</li> <li>"+s.nf_calories+"</li> </li>")}}))},onKeypress:function(){var e=this,o=-1;$(".leo-auto-suggestions").children().length>0&&$(".leo-auto-suggestions").removeClass("hidden"),$("#leo-auto-bar").off().keydown(function(t){if($("input").bind("keydown",function(e){("38"==e.which||"40"==e.which||"13"==e.which)&&e.preventDefault()}),console.log(t.which),t.which!=keys.DOWN&&t.which!=keys.UP&&t.which!=keys.ENTER&&t.which!=keys.TAB&&t.which!=keys.LEFT&&t.which!=keys.RIGHT&&t.which!=keys.ESC){var s=nSets.autoUrl+"&"+nSets.appId+"&"+nSets.appKey,i=$(this).val().trim();""!=i&&$.ajax(s+"&q="+i).fail(function(e){alert("Nutri api call failed")}).done(function(e){$(".leo-auto-suggestions").html(""),console.log(e),console.log(i),console.log(s);for(var t in e)if(e.hasOwnProperty(t)){var l=e[t].text;$(".leo-auto-suggestions").append("<div class='leo-auto-suggest' data-index='"+t+"'>"+l+"</div>")}$(".leo-auto-suggestions").removeClass("hidden"),$(".leo-auto-suggest").click(function(){$("#leo-auto-bar").val($(this).text()),$(".leo-auto-suggestions").addClass("hidden")}),$(".leo-auto-suggest").mouseenter(function(){$(".leo-auto-suggest").removeClass("leo-selected"),$(this).addClass("leo-selected"),o=-1}),$(".leo-auto-suggest").mouseleave(function(){$(this).removeClass("leo-selected")})})}t.which===keys.DOWN?(o++,$(".leo-auto-suggest").removeClass("leo-selected"),$("[data-index*='"+o+"']").addClass("leo-selected")):t.which===keys.UP&&o>0?(o--,$(".leo-auto-suggest").removeClass("leo-selected"),$("[data-index*='"+o+"']").addClass("leo-selected")):t.which===keys.ENTER&&(console.log($(".leo-selected").text()),$("#leo-auto-bar").val($(".leo-selected").text()),e.onEnter())})}});