!function(e){"use strict";"function"==typeof define&&define.amd?define(["jquery"],e):e("object"==typeof exports&&"function"==typeof require?require("jquery"):jQuery)}(function($){"use strict";function e(t,n){var o=function(){},i=this,s={ajaxSettings:{},autoSelectFirst:!1,appendTo:document.body,serviceUrl:null,lookup:null,onSelect:null,width:"auto",minChars:1,maxHeight:300,deferRequestBy:0,params:{},formatResult:e.formatResult,delimiter:null,zIndex:9999,type:"GET",noCache:!1,onSearchStart:o,onSearchComplete:o,onSearchError:o,preserveInput:!1,containerClass:"autocomplete-suggestions",tabDisabled:!1,dataType:"text",currentRequest:null,triggerSelectOnValidInput:!0,preventBadQueries:!0,lookupFilter:function(e,t,n){return-1!==e.value.toLowerCase().indexOf(n)},paramName:"query",transformResult:function(e){return"string"==typeof e?$.parseJSON(e):e},showNoSuggestionNotice:!1,noSuggestionNotice:"No results",orientation:"bottom",forceFixPosition:!1};i.element=t,i.el=$(t),i.suggestions=[],i.badQueries=[],i.selectedIndex=-1,i.currentValue=i.element.value,i.intervalId=0,i.cachedResponse={},i.onChangeInterval=null,i.onChange=null,i.isLocal=!1,i.suggestionsContainer=null,i.noSuggestionsContainer=null,i.options=$.extend({},s,n),i.classes={selected:"autocomplete-selected",suggestion:"autocomplete-suggestion"},i.hint=null,i.hintValue="",i.selection=null,i.initialize(),i.setOptions(n)}var t=function(){return{escapeRegExChars:function(e){return e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")},createNode:function(e){var t=document.createElement("div");return t.className=e,t.style.position="absolute",t.style.display="none",t}}}(),n={ESC:27,TAB:9,RETURN:13,LEFT:37,UP:38,RIGHT:39,DOWN:40};e.utils=t,$.Autocomplete=e,e.formatResult=function(e,n){var o="("+t.escapeRegExChars(n)+")";return e.value.replace(new RegExp(o,"gi"),"<strong>$1</strong>").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/&lt;(\/?strong)&gt;/g,"<$1>")},e.prototype={killerFn:null,initialize:function(){var t=this,n="."+t.classes.suggestion,o=t.classes.selected,i=t.options,s;t.element.setAttribute("autocomplete","off"),t.killerFn=function(e){0===$(e.target).closest("."+t.options.containerClass).length&&(t.killSuggestions(),t.disableKillerFn())},t.noSuggestionsContainer=$('<div class="autocomplete-no-suggestion"></div>').html(this.options.noSuggestionNotice).get(0),t.suggestionsContainer=e.utils.createNode(i.containerClass),s=$(t.suggestionsContainer),s.appendTo(i.appendTo),"auto"!==i.width&&s.width(i.width),s.on("mouseover.autocomplete",n,function(){t.activate($(this).data("index"))}),s.on("mouseout.autocomplete",function(){t.selectedIndex=-1,s.children("."+o).removeClass(o)}),s.on("click.autocomplete",n,function(){t.select($(this).data("index"))}),t.fixPositionCapture=function(){t.visible&&t.fixPosition()},$(window).on("resize.autocomplete",t.fixPositionCapture),t.el.on("keydown.autocomplete",function(e){t.onKeyPress(e)}),t.el.on("keyup.autocomplete",function(e){t.onKeyUp(e)}),t.el.on("blur.autocomplete",function(){t.onBlur()}),t.el.on("focus.autocomplete",function(){t.onFocus()}),t.el.on("change.autocomplete",function(e){t.onKeyUp(e)}),t.el.on("input.autocomplete",function(e){t.onKeyUp(e)})},onFocus:function(){var e=this;e.fixPosition(),0===e.options.minChars&&0===e.el.val().length&&e.onValueChange()},onBlur:function(){this.enableKillerFn()},abortAjax:function(){var e=this;e.currentRequest&&(e.currentRequest.abort(),e.currentRequest=null)},setOptions:function(e){var t=this,n=t.options;$.extend(n,e),t.isLocal=$.isArray(n.lookup),t.isLocal&&(n.lookup=t.verifySuggestionsFormat(n.lookup)),n.orientation=t.validateOrientation(n.orientation,"bottom"),$(t.suggestionsContainer).css({"max-height":n.maxHeight+"px",width:n.width+"px","z-index":n.zIndex})},clearCache:function(){this.cachedResponse={},this.badQueries=[]},clear:function(){this.clearCache(),this.currentValue="",this.suggestions=[]},disable:function(){var e=this;e.disabled=!0,clearInterval(e.onChangeInterval),e.abortAjax()},enable:function(){this.disabled=!1},fixPosition:function(){var e=this,t=$(e.suggestionsContainer),n=t.parent().get(0);if(n===document.body||e.options.forceFixPosition){var o=e.options.orientation,i=t.outerHeight(),s=e.el.outerHeight(),a=e.el.offset(),l={top:a.top,left:a.left};if("auto"===o){var r=$(window).height(),u=$(window).scrollTop(),c=-u+a.top-i,g=u+r-(a.top+s+i);o=Math.max(c,g)===c?"top":"bottom"}if("top"===o?l.top+=-i:l.top+=s,n!==document.body){var d=t.css("opacity"),p;e.visible||t.css("opacity",0).show(),p=t.offsetParent().offset(),l.top-=p.top,l.left-=p.left,e.visible||t.css("opacity",d).hide()}"auto"===e.options.width&&(l.width=e.el.outerWidth()-2+"px"),t.css(l)}},enableKillerFn:function(){var e=this;$(document).on("click.autocomplete",e.killerFn)},disableKillerFn:function(){var e=this;$(document).off("click.autocomplete",e.killerFn)},killSuggestions:function(){var e=this;e.stopKillSuggestions(),e.intervalId=window.setInterval(function(){e.visible&&(e.el.val(e.currentValue),e.hide()),e.stopKillSuggestions()},50)},stopKillSuggestions:function(){window.clearInterval(this.intervalId)},isCursorAtEnd:function(){var e=this,t=e.el.val().length,n=e.element.selectionStart,o;return"number"==typeof n?n===t:document.selection?(o=document.selection.createRange(),o.moveStart("character",-t),t===o.text.length):!0},onKeyPress:function(e){var t=this;if(!t.disabled&&!t.visible&&e.which===n.DOWN&&t.currentValue)return void t.suggest();if(!t.disabled&&t.visible){switch(e.which){case n.ESC:t.el.val(t.currentValue),t.hide();break;case n.RIGHT:if(t.hint&&t.options.onHint&&t.isCursorAtEnd()){t.selectHint();break}return;case n.TAB:if(t.hint&&t.options.onHint)return void t.selectHint();if(-1===t.selectedIndex)return void t.hide();if(t.select(t.selectedIndex),t.options.tabDisabled===!1)return;break;case n.RETURN:if(-1===t.selectedIndex)return void t.hide();t.select(t.selectedIndex);break;case n.UP:t.moveUp();break;case n.DOWN:t.moveDown();break;default:return}e.stopImmediatePropagation(),e.preventDefault()}},onKeyUp:function(e){var t=this;if(!t.disabled){switch(e.which){case n.UP:case n.DOWN:return}clearInterval(t.onChangeInterval),t.currentValue!==t.el.val()&&(t.findBestHint(),t.options.deferRequestBy>0?t.onChangeInterval=setInterval(function(){t.onValueChange()},t.options.deferRequestBy):t.onValueChange())}},onValueChange:function(){var e=this,t=e.options,n=e.el.val(),o=e.getQuery(n);return e.selection&&e.currentValue!==o&&(e.selection=null,(t.onInvalidateSelection||$.noop).call(e.element)),clearInterval(e.onChangeInterval),e.currentValue=n,e.selectedIndex=-1,t.triggerSelectOnValidInput&&e.isExactMatch(o)?void e.select(0):void(o.length<t.minChars?e.hide():e.getSuggestions(o))},isExactMatch:function(e){var t=this.suggestions;return 1===t.length&&t[0].value.toLowerCase()===e.toLowerCase()},getQuery:function(e){var t=this.options.delimiter,n;return t?(n=e.split(t),$.trim(n[n.length-1])):e},getSuggestionsLocal:function(e){var t=this,n=t.options,o=e.toLowerCase(),i=n.lookupFilter,s=parseInt(n.lookupLimit,10),a;return a={suggestions:$.grep(n.lookup,function(t){return i(t,e,o)})},s&&a.suggestions.length>s&&(a.suggestions=a.suggestions.slice(0,s)),a},getSuggestions:function(e){var t,n=this,o=n.options,i=o.serviceUrl,s,a,l;if(o.params[o.paramName]=e,s=o.ignoreParams?null:o.params,o.onSearchStart.call(n.element,o.params)!==!1){if($.isFunction(o.lookup))return void o.lookup(e,function(t){n.suggestions=t.suggestions,n.suggest(),o.onSearchComplete.call(n.element,e,t.suggestions)});n.isLocal?t=n.getSuggestionsLocal(e):($.isFunction(i)&&(i=i.call(n.element,e)),a=i+"?"+$.param(s||{}),t=n.cachedResponse[a]),t&&$.isArray(t.suggestions)?(n.suggestions=t.suggestions,n.suggest(),o.onSearchComplete.call(n.element,e,t.suggestions)):n.isBadQuery(e)?o.onSearchComplete.call(n.element,e,[]):(n.abortAjax(),l={url:i,data:s,type:o.type,dataType:o.dataType},$.extend(l,o.ajaxSettings),n.currentRequest=$.ajax(l).done(function(t){var i;n.currentRequest=null,i=o.transformResult(t,e),n.processResponse(i,e,a),o.onSearchComplete.call(n.element,e,i.suggestions)}).fail(function(t,i,s){o.onSearchError.call(n.element,e,t,i,s)}))}},isBadQuery:function(e){if(!this.options.preventBadQueries)return!1;for(var t=this.badQueries,n=t.length;n--;)if(0===e.indexOf(t[n]))return!0;return!1},hide:function(){var e=this,t=$(e.suggestionsContainer);$.isFunction(e.options.onHide)&&e.visible&&e.options.onHide.call(e.element,t),e.visible=!1,e.selectedIndex=-1,clearInterval(e.onChangeInterval),$(e.suggestionsContainer).hide(),e.signalHint(null)},suggest:function(){if(0===this.suggestions.length)return void(this.options.showNoSuggestionNotice?this.noSuggestions():this.hide());var e=this,t=e.options,n=t.groupBy,o=t.formatResult,i=e.getQuery(e.currentValue),s=e.classes.suggestion,a=e.classes.selected,l=$(e.suggestionsContainer),r=$(e.noSuggestionsContainer),u=t.beforeRender,c="",g,d=function(e,t){var o=e.data[n];return g===o?"":(g=o,'<div class="autocomplete-group"><strong>'+g+"</strong></div>")};return t.triggerSelectOnValidInput&&e.isExactMatch(i)?void e.select(0):($.each(e.suggestions,function(e,t){n&&(c+=d(t,i,e)),c+='<div class="'+s+'" data-index="'+e+'">'+o(t,i)+"</div>"}),this.adjustContainerWidth(),r.detach(),l.html(c),$.isFunction(u)&&u.call(e.element,l),e.fixPosition(),l.show(),t.autoSelectFirst&&(e.selectedIndex=0,l.scrollTop(0),l.children("."+s).first().addClass(a)),e.visible=!0,void e.findBestHint())},noSuggestions:function(){var e=this,t=$(e.suggestionsContainer),n=$(e.noSuggestionsContainer);this.adjustContainerWidth(),n.detach(),t.empty(),t.append(n),e.fixPosition(),t.show(),e.visible=!0},adjustContainerWidth:function(){var e=this,t=e.options,n,o=$(e.suggestionsContainer);"auto"===t.width&&(n=e.el.outerWidth()-2,o.width(n>0?n:300))},findBestHint:function(){var e=this,t=e.el.val().toLowerCase(),n=null;t&&($.each(e.suggestions,function(e,o){var i=0===o.value.toLowerCase().indexOf(t);return i&&(n=o),!i}),e.signalHint(n))},signalHint:function(e){var t="",n=this;e&&(t=n.currentValue+e.value.substr(n.currentValue.length)),n.hintValue!==t&&(n.hintValue=t,n.hint=e,(this.options.onHint||$.noop)(t))},verifySuggestionsFormat:function(e){return e.length&&"string"==typeof e[0]?$.map(e,function(e){return{value:e,data:null}}):e},validateOrientation:function(e,t){return e=$.trim(e||"").toLowerCase(),-1===$.inArray(e,["auto","bottom","top"])&&(e=t),e},processResponse:function(e,t,n){var o=this,i=o.options;e.suggestions=o.verifySuggestionsFormat(e.suggestions),i.noCache||(o.cachedResponse[n]=e,i.preventBadQueries&&0===e.suggestions.length&&o.badQueries.push(t)),t===o.getQuery(o.currentValue)&&(o.suggestions=e.suggestions,o.suggest())},activate:function(e){var t=this,n,o=t.classes.selected,i=$(t.suggestionsContainer),s=i.find("."+t.classes.suggestion);return i.find("."+o).removeClass(o),t.selectedIndex=e,-1!==t.selectedIndex&&s.length>t.selectedIndex?(n=s.get(t.selectedIndex),$(n).addClass(o),n):null},selectHint:function(){var e=this,t=$.inArray(e.hint,e.suggestions);e.select(t)},select:function(e){var t=this;t.hide(),t.onSelect(e)},moveUp:function(){var e=this;if(-1!==e.selectedIndex)return 0===e.selectedIndex?($(e.suggestionsContainer).children().first().removeClass(e.classes.selected),e.selectedIndex=-1,e.el.val(e.currentValue),void e.findBestHint()):void e.adjustScroll(e.selectedIndex-1)},moveDown:function(){var e=this;e.selectedIndex!==e.suggestions.length-1&&e.adjustScroll(e.selectedIndex+1)},adjustScroll:function(e){var t=this,n=t.activate(e);if(n){var o,i,s,a=$(n).outerHeight();o=n.offsetTop,i=$(t.suggestionsContainer).scrollTop(),s=i+t.options.maxHeight-a,i>o?$(t.suggestionsContainer).scrollTop(o):o>s&&$(t.suggestionsContainer).scrollTop(o-t.options.maxHeight+a),t.options.preserveInput||t.el.val(t.getValue(t.suggestions[e].value)),t.signalHint(null)}},onSelect:function(e){var t=this,n=t.options.onSelect,o=t.suggestions[e];t.currentValue=t.getValue(o.value),t.currentValue===t.el.val()||t.options.preserveInput||t.el.val(t.currentValue),t.signalHint(null),t.suggestions=[],t.selection=o,$.isFunction(n)&&n.call(t.element,o)},getValue:function(e){var t=this,n=t.options.delimiter,o,i;return n?(o=t.currentValue,i=o.split(n),1===i.length?e:o.substr(0,o.length-i[i.length-1].length)+e):e},dispose:function(){var e=this;e.el.off(".autocomplete").removeData("autocomplete"),e.disableKillerFn(),$(window).off("resize.autocomplete",e.fixPositionCapture),$(e.suggestionsContainer).remove()}},$.fn.autocomplete=$.fn.devbridgeAutocomplete=function(t,n){var o="autocomplete";return 0===arguments.length?this.first().data(o):this.each(function(){var i=$(this),s=i.data(o);"string"==typeof t?s&&"function"==typeof s[t]&&s[t](n):(s&&s.dispose&&s.dispose(),s=new e(this,t),i.data(o,s))})}});